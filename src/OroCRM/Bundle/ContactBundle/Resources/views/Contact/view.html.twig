{% extends 'OroUIBundle:actions:view.html.twig' %}
{% import 'OroTagBundle::macros.html.twig' as _tag %}
{% import 'OroUIBundle::macros.html.twig' as macros %}
{% import 'OroAddressBundle:Include:viewMacro.html.twig' as addressView %}
{% set format = oro_config_value('oro_user.name_format') %}
{% set fullname = entity.fullname(format)|default('N/A') %}
{% oro_title_set({params : {"%contact.name%": fullname} }) %}
{% set gridId = 'accounts-grid' %}
{% block head_script %}
    {{ parent() }}
    {% placeholder prepare_grid with {'datagrid': datagrid, 'selector': '#' ~ gridId} %}
{% endblock %}

{% block navButtons %}
    {% if resource_granted('orocrm_contact_update') %}
        {{ UI.button({'path' : path('orocrm_contact_update', { 'id': entity.id }), 'iClass' : 'icon-edit ', 'title' : 'Update contact', 'label' : 'Edit'}) }}
    {% endif %}
    {% if resource_granted('orocrm_contact_delete') %}
        {{ UI.deleteButton({
                'dataUrl': path('oro_api_delete_contact', {'id': entity.id}) ,
                'dataRedirect': path('orocrm_contact_index'),
                'aCss': 'no-hash remove-button',
                'id': 'btn-remove-contact',
                'dataId': entity.id,
                'dataMessage': 'Are you sure you want to delete this contact?',
                'title': 'Delete Contact',
                'label': 'Delete'
            })
        }}
    {% endif %}
{% endblock navButtons %}

{% block pageHeader %}
    {% set breadcrumbs = {'entity': entity, 'indexPath': path('orocrm_contact_index'), 'indexLabel': 'Contacts', 'entityTitle': fullname } %}
    {{ parent() }}
{% endblock pageHeader %}

{% block content_data %}
    {% set id = 'navbarContactsUpdate' %}

    {% set addresses = [] %}
    {% set yesNoChoices = {0: 'No'|trans, 1: 'Yes'|trans} %}
    {% for addressValue in entity.addresses %}
        {% set primaryData = attribute(addressValue, 'primary') %}
        {% set primaryData = yesNoChoices[primaryData]|default('No'|trans) %}
        {% set addresses = addresses|merge([
            addressView.renderAddressView(addressValue, [{'label': 'Types', 'value': addressValue.typeLabels|join(', ')}]),
            addressView.renderAddressView(addressValue, [{'label': 'Primary', 'value': primaryData}]),
            addressView.renderAddress(addressValue),
            '<hr/>'
        ]) %}
    {% endfor %}

    {% set dataSubBlocks = [
        {
            'title': 'Basic Information',
            'data': [
                UI.attibuteRow('Name Prefix', entity.namePrefix|default('N/A')),
                UI.attibuteRow('First Name', entity.firstName),
                UI.attibuteRow('Last Name', entity.lastName),
                UI.attibuteRow('Name Suffix', entity.nameSuffix|default('N/A')),
                UI.attibuteRow('Title', entity.title|default('N/A')),
                UI.attibuteRow('Birthday', entity.birthday ? UI.date(entity.birthday) : 'N/A'),
                UI.attibuteRow('Description', entity.description|default('N/A')),
                UI.attibuteRow('Source', entity.source|default('N/A')),
                UI.attibuteRow('Assigned To', entity.assignedTo.__toString|default('N/A')),
                UI.attibuteRow('Reports To', entity.reportsTo.__toString|default('N/A')),
                UI.attibuteRow('Email', entity.email|default('N/A')),
                UI.attibuteRow('Phone', entity.phone|default('N/A'))
            ]
        }
    ] %}
    {% if addresses is not empty %}
        {% set addressSubBlock = {
            'title': 'Addresses',
            'data': addresses
        } %}
        {% set dataSubBlocks = dataSubBlocks|merge([addressSubBlock]) %}
    {% endif %}

    {% if resource_granted('oro_tag_view_tag_cloud') %}
        {% set dataSubBlocks = dataSubBlocks|merge([{
            title: '',
            data : [UI.renderAttribute('Tags', _tag.renderView(entity))]
        }]) %}
    {% endif %}

    {% set dataBlocks = [
        {
            'title': 'General',
            'class': 'active',
            'subblocks': dataSubBlocks
        }
    ] %}
    {% set dataBlocks = dataBlocks|merge([{'title' : 'Accounts', 'subblocks': [{'title' : null, 'data' : [UI.gridBlock(gridId)], 'useSpan': false}] }])%}
    {% set data =
        {
            'dataBlocks': dataBlocks,
        }
    %}
    {{ parent() }}
{% endblock content_data %}
