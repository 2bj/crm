{% extends 'OroUIBundle:actions:view.html.twig' %}
{% import 'OroTagBundle::macros.html.twig' as _tag %}
{% import 'OroUIBundle::macros.html.twig' as macros %}
{% import 'OroAddressBundle:Include:viewMacro.html.twig' as addressView %}
{% set format = oro_config_value('oro_user.name_format') %}
{% set fullname = entity.fullname(format)|default('N/A') %}
{% oro_title_set({params : {"%contact.name%": fullname} }) %}
{% set gridId = 'accounts-grid' %}
{% block head_script %}
    {{ parent() }}
    {% placeholder prepare_grid with {'datagrid': datagrid, 'selector': '#' ~ gridId} %}
{% endblock %}

{% block navButtons %}
    {% if resource_granted('orocrm_contact_update') %}
        {{ UI.button({'path' : path('orocrm_contact_update', { 'id': entity.id }), 'iClass' : 'icon-edit ', 'title' : 'Update contact', 'label' : 'Edit'}) }}
    {% endif %}
    {% if resource_granted('orocrm_contact_delete') %}
        {{ UI.deleteButton({
                'dataUrl': path('oro_api_delete_contact', {'id': entity.id}) ,
                'dataRedirect': path('orocrm_contact_index'),
                'aCss': 'no-hash remove-button',
                'id': 'btn-remove-contact',
                'dataId': entity.id,
                'dataMessage': 'Are you sure you want to delete this contact?',
                'title': 'Delete Contact',
                'label': 'Delete'
            })
        }}
    {% endif %}
{% endblock navButtons %}

{% block pageHeader %}
    {% set breadcrumbs = {'entity': entity, 'indexPath': path('orocrm_contact_index'), 'indexLabel': 'Contacts', 'entityTitle': fullname } %}
    {{ parent() }}
{% endblock pageHeader %}

{% block content_data %}
    <div class="well-small form-horizontal dark-bg">
        <div class="clearfix">
            <div class="row-fluid  well-small-bottom">
                {#<div class="span6">#}
                    {#{{#}
                        {#oro_widget_render({#}
                            {#'widgetType': 'block',#}
                            {#'url': path('orocrm_contact_info', {id: entity.id}),#}
                            {#'title': 'Contact Information'#}
                        {#})#}
                    {#}}#}
                {#</div>#}
                <div class="span6">
                    <script type="text/html" id="template-contact-address">
                        <div class="map-item <% if (isPrimary) { %>active<% } %>">
                            <div class="clearfix">
                                <div class="title-item"><%= label %></div>
                                <div class="map-actions">
                                    <button class="btn"><i class="icon-edit hide-text"><%= _.__('Edit') %></i></button>
                                    <button class="btn"><i class="icon-remove hide-text"><%= _.__('Close') %></i></button>
                                </div>
                            </div>
                            <ul class="inline">
                                <% if(isPrimary) { %> <li><span class="label label-info"><%= _.__('Primary') %></span></li> <% } %>
                                <% _.each(types, function(type) { %>
                                <li><span class="label"><%= type %></span></li>
                                <% } %>
                            </ul>
                            <address>
                                <%= street %> <%= street2 %><br />
                                <% city %>, <%= state %><br />
                                <%= postalCode %><br />
                                <%= country =><br />
                            </address>
                        </div>
                    </script>

                    <script type="text/html" id="template-contact-address-book">
                        <div class="map-box">
                            <div class="map-address-list"></div>
                            <div class="map-visual"></div>
                        </div>
                    </script>

                    <div id="address-book"></div>
                    <script type="text/javascript">
                        $(function() {
                            new OroAddressBook({
                                el: '#address-book',
                                collection: new OroAddressCollection([
                                    new OroAddress({
                                        'id': 1,
                                        'street': 'Street',
                                        'street2': 'Street2',
                                        'city': 'City',
                                        'country': 'Country',
                                        'postalCode': 'postalCode',
                                        'state': 'State',
                                        'isPrimary': true,
                                        'types': ['type1', 'type2']
                                    })
                                ])
                            }).render();
                        });
                    </script>
                    {#{{#}
                        {#oro_widget_render({#}
                            {#'widgetType': 'block',#}
                            {#'url': path('orocrm_contact_address_book', {id: entity.id}),#}
                            {#'title': 'Address Book'#}
                        {#})#}
                    {#}}#}
                </div>
            </div>
        </div>
    </div>
{% endblock content_data %}
