{% extends 'OroUIBundle:actions:view.html.twig' %}
{% import 'OroUIBundle::macros.html.twig' as macros %}
{% import 'OroAddressBundle:Include:viewMacro.html.twig' as addressView %}
{% set format = oro_config_value('oro_user.name_format') %}
{% oro_title_set({params : {"%account.name%": account.name|default('N/A')} }) %}

{% block head_script %}
    {% include 'OroCRMAccountBundle:Account:remove.confirm.js.twig' %}
{% endblock %}

{% block navButtons %}
    {{ UI.button(path('orocrm_account_index'), 'icon-chevron-left ', 'Back', 'Back') }}
    {% if resource_granted('orocrm_account_account_update') %}
       {{ UI.button(path('orocrm_account_update', { id: account.id }), 'icon-edit', 'Edit account', 'Edit') }}
    {% endif %}

    {% if resource_granted('orocrm_account_account_remove') %}
        {{ UI.deleteButton({
        aCss: 'no-hash remove-button', dataId: account.id, dataMessage: 'Are you sure you want to delete this account?', title: 'Delete Account', label: 'Delete'
        }) }}
    {% endif %}
{% endblock navButtons %}

{% block pageHeader %}
    {% include ('OroCRMAccountBundle:Account:account_block.html.twig') %}
{% endblock pageHeader %}

{% block scroll_data %}
    {% set attributes = {} %}
    {% for value in account|getAttributes() %}
        {% set attributes = attributes | merge([UI.flexibleAttributeRow(value)]) %}
    {% endfor %}

    {% set accountAddresses = {} %}
    {% if account|hasAddress %}
        {% for value in account|getAttributes(['shipping_address', 'billing_address']) %}
            {% set address = value.data %}
            {% if address is not null %}
                {% set accountAddresses = accountAddresses|merge([{'title': value.attribute.label, 'data': [addressView.renderAddress(address)]}]) %}
            {% endif %}
        {% endfor %}
    {% endif %}

    {% if account.values is defined %}
        {% set col = 2 %}
        {% set additional = {} %}
        {% set additionalAttributes = account|getAttributes(['shipping_address', 'billing_address'], true) %}
        {% set attributes = {} %}
        {% set half = (additionalAttributes|length / col)|ceil %}

        {% for value in additionalAttributes %}

            {% set attributes = attributes | merge([UI.flexibleAttributeRow(value)]) %}

            {% if loop.index % half == 0  and not loop.last %}
                {% set additional = additional|merge([{'title' : null, 'data' : attributes}]) %}
                {% set attributes = {} %}
            {% endif %}

        {% endfor %}
        {% set additional = additional|merge([{'title' : null, 'data' : attributes}]) %}
    {% endif %}

    {% set id = 'user-profile' %}
    {% set data =
            [
                {
                    'title': 'General',
                    'class': 'active',
                    'subblocks': [
                        {
                            'title': 'Basic Information',
                            'data': [
                                UI.attibuteRow('Account Name', account.name),
                            ]
                        }
                    ]
                }
            ]
    %}
    {% if (accountAddresses|length) %}
    {% set data = data|merge([{'title' : 'Addresses', 'subblocks': accountAddresses}])%}
    {% endif %}
    {% if (additional|length) %}
        {% set data = data|merge([{'title' : 'Additional Information', 'subblocks': additional}])%}
    {% endif %}
    {% set data = data|merge([{'title' : 'Contacts', 'subblocks': '<div class="row-fluid"><div id="contacts-grid"></div></div>'}])%}
    {{ parent() }}
{% endblock scroll_data %}
